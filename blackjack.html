<!DOCTYPE html>
<html>
<head>
<title>Executive Blackjack</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="center execTable">

<h1>Blackjack</h1>

<div class="paybox gold">Dealer: Valentina</div>

<div class="paybox">
<input id="betInput" type="number" value="100">
<button onclick="startGame()">Place Bet</button>
</div>

<div id="game" style="display:none">

<div class="paybox">
<div id="playerCards" class="cards"></div>
Total: <span id="playerTotal"></span>
</div>

<div class="paybox">
<div id="dealerCards" class="cards"></div>
Total: <span id="dealerTotal"></span>
</div>

<button onclick="hit()">Hit</button>
<button onclick="stand()">Stand</button>

</div>

<script>
let bet,balance,player=[],dealer=[],playing=false;
const faces=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
const suits=["♠","♥","♦","♣"];

function logTx(type, amount, note){
 let tx=JSON.parse(localStorage.getItem("tx")||"[]");
 tx.unshift({
   time:new Date().toLocaleString(),
   type:type,
   amount:amount,
   note:note||""
 });
 tx=tx.slice(0,100); // keep last 100
 localStorage.setItem("tx",JSON.stringify(tx));
}

function addGame(w,wins){
 let wg=parseFloat(localStorage.getItem("wagered")||0);
 let wo=parseFloat(localStorage.getItem("won")||0);
 let g=parseInt(localStorage.getItem("games")||0);
 wg+=w; if(wins>0) wo+=parseFloat(wins); g++;
 localStorage.setItem("wagered",wg.toFixed(2));
 localStorage.setItem("won",wo.toFixed(2));
 localStorage.setItem("games",g);
}

function card(){
 let f=faces[Math.floor(Math.random()*faces.length)];
 let s=suits[Math.floor(Math.random()*suits.length)];
 let v=(f==="A")?11:(["J","Q","K"].includes(f)?10:parseInt(f));
 return {f,s,v};
}

function total(h){
 let t=h.reduce((a,b)=>a+b.v,0);
 let a=h.filter(c=>c.f==="A").length;
 while(t>21&&a){t-=10;a--;}
 return t;
}

function draw(el,h){
 el.innerHTML="";
 h.forEach(c=>{
  let d=document.createElement("div");
  d.className="card";
  d.innerHTML=c.f+"<br>"+c.s;
  el.appendChild(d);
 });
 playerTotal.innerHTML=total(player);
 dealerTotal.innerHTML=total(dealer);
}

function startGame(){
 bet=parseFloat(betInput.value);
 balance=parseFloat(localStorage.getItem("balance")||0);
 if(balance<bet){alert("No balance");return;}
 balance-=bet;
 localStorage.setItem("balance",balance.toFixed(2));
 game.style.display="block";
 player=[card(),card()];
 dealer=[card(),card()];
 playing=true;
 draw(playerCards,player); draw(dealerCards,dealer);
}

function hit(){
 if(!playing)return;
 player.push(card());
 draw(playerCards,player);
 if(total(player)>21){addGame(bet,0);logTx("Blackjack Loss", -bet, "Player bust");end("BUST","-"+bet);}
}

function stand(){
 let t=setInterval(()=>{
 if(total(dealer)<17){dealer.push(card());draw(dealerCards,dealer);}
 else{clearInterval(t);resolve();}
 },600);
}

function resolve(){
 let p=total(player),d=total(dealer);
 let mult=(localStorage.getItem("tier")==="Executive")?2.2:2;
 if(d>21||p>d){
   let win=(bet*mult).toFixed(2);
   balance=parseFloat(localStorage.getItem("balance"))+parseFloat(win);
   localStorage.setItem("balance",balance.toFixed(2));
   addGame(bet,win);
   end("YOU WIN","+$"+win);
   logTx("Blackjack Win", win, "Dealer beaten");
 }else{
   addGame(bet,0);
   end("DEALER WINS","-"+bet);
   logTx("Blackjack Loss", -bet, "Dealer wins");
 }
}

function end(t,a){
 document.body.innerHTML=`<div class="center execTable"><h1>${t}</h1><h2>${a}</h2><button onclick="location.href='members.html'">Return</button></div>`;
}
</script>

<style>
.execTable{background:#200}
.cards{display:flex;gap:6px;justify-content:center}
.card{background:white;color:black;width:40px;height:60px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:bold}
.gold{border:1px solid gold}
</style>

</div>
</body>
</html>